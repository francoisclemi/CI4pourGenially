<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Feux de Forêt - NASA FIRMS</title>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css"/>
    <style>
        #map { height: 500px; width: 100%; }
        body { font-family: Arial, sans-serif; }
    </style>
</head>
<body>
    <h2>Recherche de Feux de Forêt (NASA FIRMS)</h2>
    <label for="latitude">Latitude :</label>
    <input type="number" id="latitude" step="0.0001" required>
    <label for="longitude">Longitude :</label>
    <input type="number" id="longitude" step="0.0001" required>
    <button onclick="fetchFireData()">Rechercher</button>
    <div id="map"></div>

    <script>
        // Initialisation de la carte avec une vue satellite
        let map = L.map('map').setView([0, 0], 2);

        L.tileLayer('https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=VOTRE_CLE_API_MAPBOX', {
            maxZoom: 19,
            attribution: 'Données &copy; <a href="https://www.nasa.gov">NASA FIRMS</a> & <a href="https://www.mapbox.com/">Mapbox</a>'
        }).addTo(map);

        async function fetchFireData() {
            const lat = document.getElementById("latitude").value;
            const lon = document.getElementById("longitude").value;
            const radius = 50;  // Rayon de recherche en kilomètres

            const url = `https://firms.modaps.eosdis.nasa.gov/api/area/csv/fdd6dcf89555f8033a00cf0116de4656?latitude=${lat}&longitude=${lon}&radius=${radius}&fireType=all`;

            try {
                const response = await fetch(url);
                const data = await response.text();
                displayFireData(data, lat, lon);
            } catch (error) {
                console.error("Erreur lors de la récupération des données : ", error);
            }
        }

        function displayFireData(data, lat, lon) {
            // Effacer les marqueurs existants
            map.eachLayer(layer => {
                if (layer instanceof L.Circle) layer.remove();
            });

            // Centrer la carte sur les coordonnées spécifiées
            map.setView([lat, lon], 7);

            const firePoints = data.split('\n').slice(1).map(line => line.split(','));
            
            firePoints.forEach(fire => {
                if (fire[0] && fire[1]) {
                    const fireLat = parseFloat(fire[0]);
                    const fireLon = parseFloat(fire[1]);
                    L.circle([fireLat, fireLon], {
                        color: 'red',
                        radius: 5000,
                        fillOpacity: 0.5
                    }).addTo(map).bindPopup(`<b>Feu détecté</b><br>Latitude: ${fireLat}<br>Longitude: ${fireLon}`);
                }
            });
        }
    </script>
</body>
</html>
